# 架構總覽（草案）

## 範圍
本文件說明 LIFF 後端與機台整合的高階系統結構，依據 backend-spec v0.3。

## 角色
- 消費者：回報問題並查看案件狀態與回覆。
- 營運者：管理商品主檔與庫存預約樣板。
- 巡補員：產生揀貨清單並執行現場補貨。

## 核心元件
- LIFF 用戶端
  - 消費者 LIFF
  - 營運者 LIFF
  - 巡補員 LIFF
- 後端服務
  - 身分驗證/識別（LINE userId）
  - 客服服務
  - 商品主檔
  - 庫存預約樣板
  - 巡補作業
  - 機台管理
- 資料儲存
  - 後端資料庫（商品、樣板、工單、回報）
  - 物件儲存（圖片、附件）
- 機台端
  - 機台執行環境
  - 本機資料庫（即時庫存、巡補寫入）
- 整合層
  - MQ/Web Services：用於後端與機台的資料同步

## 資料權威
- 後端資料庫是商品主檔與庫存預約樣板的權威來源。
- 機台本機資料庫是銷售期間即時庫存的權威來源。
- 巡補寫入僅在巡補作業結束後提交至機台本機資料庫。

## 主要資料流程
- 消費者客服工單：LIFF -> 後端 -> 資料庫（附件存於物件儲存）。
- 營運者商品/樣板管理：LIFF -> 後端 -> 資料庫。
- 巡補員揀貨清單：LIFF -> 後端 -> 資料庫 + 機台資料彙整。
- 現場巡補：LIFF -> 後端（驗證）-> 機台（作業結束時寫入）。

## 限制
- 權限由後端依角色與資料範圍控管。
- 銷售模式下禁止巡補寫入，且需現場簽到。
